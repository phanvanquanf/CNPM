@model IList<hotels.Areas.Admin.Models.tblDichVu>

@{
    ViewBag.Title = "D·ªãch v·ª• Spa";
}

<main class="main">
    <div class="page-title light-background">
        <div class="container d-lg-flex justify-content-between align-items-center">
            <h1 class="mb-2 mb-lg-0">∆Øu ƒë√£i Spa</h1>
            <nav class="breadcrumbs">
                <ol>
                    <li><a href="/Home/Index">Trang ch·ªß</a></li>
                    <li class="current">∆Øu ƒë√£i</li>
                </ol>
            </nav>
        </div>
    </div>

    <section id="offers" class="offers section">
        <div class="container" data-aos="fade-up" data-aos-delay="100">
            <div class="row gy-4">

                @{
                    int delay = 200;
                    var offersLarge = Model.Take(2).ToList();
                }
                @foreach (var offer in offersLarge)
                {
                    <div class="col-lg-6" data-aos="fade-up" data-aos-delay="@delay">
                        <div class="offer-card">
                            <div class="offer-image">
                                <img src="~/assets/img/services/Spa/@offer.Image" alt="@offer.DichVu" class="img-fluid">
                                <div class="offer-badge">
                                    <span class="discount">∆ØU ƒê√ÉI</span>
                                </div>
                            </div>
                            <div class="offer-content">
                                <h3>@offer.DichVu</h3>
                                <p>@offer.MoTa</p>
                                <div class="offer-details">
                                    <div class="price-info">
                                        <span class="discounted-price">@offer.GiaDichVu.ToString("N0") ƒë</span>
                                        <span class="per-session">m·ªói bu·ªïi</span>
                                    </div>
                                </div>
                                <a href="#booking" class="btn btn-primary">ƒê·∫∑t ngay</a>
                            </div>
                        </div>
                    </div>
                }

                @{
                    delay = 400;
                    var offersSmall = Model.Skip(2).Take(4).ToList();
                }
                @foreach (var offer in offersSmall)
                {
                    <div class="col-lg-4" data-aos="fade-up" data-aos-delay="@delay">
                        <div class="offer-card compact">
                            <div class="offer-image">
                                <img src="~/assets/img/services/Spa/@offer.Image" alt="@offer.DichVu" class="img-fluid">
                                <div class="offer-badge">
                                    <span class="discount">∆ØU ƒê√ÉI</span>
                                </div>
                            </div>
                            <div class="offer-content">
                                <h4>@offer.DichVu</h4>
                                <p>@offer.MoTa</p>
                                <div class="offer-details">
                                    <div class="price-info">
                                        <span class="discounted-price">@offer.GiaDichVu.ToString("N0") ƒë</span>
                                        <span class="per-session">m·ªói bu·ªïi</span>
                                    </div>
                                </div>
                                <a href="#booking" class="btn btn-outline-primary">ƒê·∫∑t l·ªãch</a>
                            </div>
                        </div>
                    </div>
                }

            </div>
        </div>
    </section>

    <section id="booking" class="section booking mt-5">
        <div class="container section-title text-center" data-aos="fade-up">
            <span class="description-title">ƒê·∫∑t tr∆∞·ªõc</span>
            <h2>L√™n l·ªãch ƒë·∫∑t d·ªãch v·ª• Spa</h2>
            <p>Ch·ªçn li·ªáu tr√¨nh y√™u th√≠ch v√† ƒë·∫∑t l·ªãch tr∆∞·ªõc ƒë·ªÉ ch√∫ng t√¥i chu·∫©n b·ªã t·ªët nh·∫•t cho b·∫°n.</p>
        </div>

      <div class="container py-5" data-aos="fade-up" data-aos-delay="100">
            <div class="p-5 rounded-4 shadow-lg bg-light mx-auto" style="max-width: 950px;">
                <h2 class="display-4 fw-bold text-center mb-5 text-primary">
                    üíÜ‚Äç‚ôÄÔ∏è ƒê·∫∑t l·ªãch Spa th∆∞ gi√£n
                </h2>

                <form asp-area="Admin" asp-action="BookingSpa" asp-controller="BookingServices" method="post" class="row g-4">
                    <input type="hidden" name="IDTaiKhoan" value="@Context.Session.GetInt32("IDTaiKhoan")" />

                    <!-- Ng√†y s·ª≠ d·ª•ng -->
                    <div class="col-md-6">
                        <label for="NgaySuDung" class="form-label fw-semibold">
                            <i class="bi bi-calendar-date me-2 text-success"></i>Ng√†y s·ª≠ d·ª•ng
                        </label>
                        <input type="date" id="NgaySuDung" name="NgaySuDung" class="form-control form-control-lg"
                            value="@DateTime.Now.ToString("yyyy-MM-dd")" required />
                    </div>

                    <!-- S·ªë ng∆∞·ªùi -->
                    <div class="col-md-6">
                        <label for="SoLuong" class="form-label fw-semibold">
                            <i class="bi bi-people-fill me-2 text-secondary"></i>S·ªë ng∆∞·ªùi
                        </label>
                        <input type="number" id="SoLuong" name="SoLuong" class="form-control form-control-lg"
                            min="1" value="1" required />
                    </div>

                    <!-- G√≥i Spa -->
                    <div class="col-12 mt-3">
                        <h5 class="fw-bold text-dark mb-3">
                            <i class="bi bi-spa text-primary me-2"></i>Ch·ªçn g√≥i Spa
                        </h5>
                       <div class="row g-4">
                        @foreach (var spa in Model)
                        {
                            var price = spa.GiaUuDai > 0 && spa.GiaUuDai < spa.GiaDichVu
                                ? spa.GiaUuDai
                                : spa.GiaDichVu;

                            <div class="col-lg-6 col-md-12">
                                <div class="card border-0 shadow-sm h-100 spa-card">
                                    <div class="card-body">
                                        <div class="d-flex align-items-center gap-3 mb-3">
                                            <img src="~/assets/img/services/Spa/@spa.Image" alt="@spa.DichVu"
                                                class="rounded" style="width: 90px; height: 90px; object-fit: cover;" />
                                            <div class="flex-grow-1">
                                                <div class="form-check">
                                                    <input class="form-check-input spa-checkbox" type="checkbox"
                                                        name="SelectedDishes[@spa.IDDichVu].IsSelected"
                                                        id="spa_@spa.IDDichVu" value="true" data-price="@price" />
                                                    <label class="form-check-label fw-bold" for="spa_@spa.IDDichVu">
                                                        @spa.DichVu
                                                    </label>
                                                </div>
                                                <small class="text-muted d-block mb-1">@spa.MoTa</small>
                                                <span class="fw-bold text-success">@price?.ToString("N0") ƒë</span>
                                            </div>
                                        </div>

                                        <div class="mb-2">
                                            <label class="form-label small fw-semibold" for="qty_@spa.IDDichVu">
                                                S·ªë bu·ªïi
                                            </label>
                                            <input type="number" class="form-control spa-qty" min="1" value="1"
                                                name="SelectedDishes[@spa.IDDichVu].Quantity"
                                                id="qty_@spa.IDDichVu" data-price="@price" />
                                        </div>

                                        <div class="border-top pt-2 mt-2">
                                            <strong>Th√†nh ti·ªÅn: </strong>
                                            <span class="spa-total text-danger fw-bold" id="total_@spa.IDDichVu">0 ƒë</span>
                                            <input type="hidden" name="SelectedDishes[@spa.IDDichVu].ThanhTien"
                                                class="spa-total-input" />
                                        </div>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>

                </div>

                    <!-- T·ªïng c·ªông -->
                    <div class="col-12 text-end mt-4 border-top pt-3">
                        <h4 class="fw-bold text-dark">
                            T·ªïng c·ªông: <span id="grandTotal" class="text-danger">0 ƒë</span>
                        </h4>
                        <input type="hidden" name="ThanhTien" id="GrandTotalInput" />
                    </div>

                    <!-- Gi·ªù s·ª≠ d·ª•ng -->
                    <div class="col-md-6">
                        <label for="GioSuDung" class="form-label fw-semibold">
                            <i class="bi bi-clock me-2 text-info"></i>Gi·ªù s·ª≠ d·ª•ng
                        </label>
                        <input type="time" id="GioSuDung" name="GioSuDung" class="form-control form-control-lg" required />
                    </div>

                    <!-- Ghi ch√∫ -->
                    <div class="col-12">
                        <label for="GhiChu" class="form-label fw-semibold">
                            <i class="bi bi-chat-left-text me-2 text-muted"></i>Ghi ch√∫
                        </label>
                        <textarea id="GhiChu" name="GhiChu" class="form-control form-control-lg" rows="3"
                                placeholder="VD: Mu·ªën massage Th√°i, tinh d·∫ßu lavender,..."></textarea>
                    </div>

                    <!-- N√∫t g·ª≠i -->
                    <div class="col-12 text-center mt-4">
                        <button type="submit" class="btn btn-primary btn-lg px-5 py-3 rounded-pill shadow-sm">
                            <i class="bi bi-send-fill me-2"></i> ƒê·∫∑t l·ªãch Spa
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>
</main>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const form = document.querySelector("form.booking-form");
    const checkboxes = document.querySelectorAll(".spa-checkbox");
    const qtyInputs = document.querySelectorAll(".spa-qty");
    const totalSpans = document.querySelectorAll(".spa-total");
    const totalInputs = document.querySelectorAll(".spa-total-input");
    const grandTotalSpan = document.getElementById("grandTotal");
    const grandTotalInput = document.getElementById("GrandTotalInput");

    if (!form || checkboxes.length === 0) return;
// G·∫Øn s·ª± ki·ªán cho checkbox v√† s·ªë l∆∞·ª£ng
    checkboxes.forEach(chk => chk.addEventListener("change", updateTotals));
    qtyInputs.forEach(qty => qty.addEventListener("input", updateTotals));

    // Ch·∫∑n submit n·∫øu kh√¥ng ch·ªçn checkbox n√†o
    form.onsubmit = function (e) {
        const anyChecked = Array.from(checkboxes).some(chk => chk.checked);
        if (!anyChecked) {
            e.preventDefault(); // ch·∫∑n submit
            alert("‚ö†Ô∏è Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt g√≥i Spa tr∆∞·ªõc khi ƒë·∫∑t l·ªãch!");
            return false; // ch·∫Øc ch·∫Øn kh√¥ng submit
        }
    };
    // H√†m t√≠nh t·ªïng
    function updateTotals() {
        let grandTotal = 0;

        checkboxes.forEach((chk, i) => {
            const price = parseInt(chk.dataset.price) || 0;
            const qty = parseInt(qtyInputs[i]?.value) || 0;
            const total = chk.checked ? price * qty : 0;

            if (totalSpans[i]) totalSpans[i].innerText = total.toLocaleString() + " ƒë";
            if (totalInputs[i]) totalInputs[i].value = total;

            grandTotal += total;
        });

        grandTotalSpan.innerText = grandTotal.toLocaleString() + " ƒë";
        grandTotalInput.value = grandTotal;
    }
    // C·∫≠p nh·∫≠t l·∫ßn ƒë·∫ßu
    updateTotals();
});
</script>


<style>
.spa-card {
    transition: transform 0.2s ease, box-shadow 0.3s ease;
    border-radius: 1rem;
}
.spa-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
}
#grandTotal {
    font-size: 1.5rem;
}
</style>